<!doctype html>
<html>
<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
  <script src="./javascripts/csv2json.js"></script>
</head>
<body>
  <input type="file" id="files" name="files[]" multiple />
  <input type="radio" name="format" value="columns" checked>  <label>Columns</label>
  <input type="radio" name="format" value="rows">  <label>Rows</label>
  <pre id="list"></pre>

  <script>
    function handleResults( array ) {
      console.log(array);

      jQuery("#list").html(
        JSON.stringify( array ).replace( /\[/g, "\n[" ).replace( /\],/g, "],\n" )
      );
    }

    jQuery("#files").on("change", function( ev ) {
      var files = ev.target.files;

      Array.prototype.forEach.call( files, function( file ) {
        var reader = new FileReader();

        reader.onload = function( ev ) {
          handleResults( window.csv2json( ev.target.result, {
            cb : handleResults,
            arrangement : jQuery("[name='format']:checked").val(),
            firstRowHeaders : true
          }) );
        };

        reader.readAsText( file );
      });
    });
  </script>
</body>
</html>
